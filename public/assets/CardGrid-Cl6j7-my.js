import{_ as G,r as c,o as K,a as V,b as u,d as r,f as j,F as A,g as F,w as b,i as X,e as t,h,t as w,n as Y,T as q}from"./index-ChsXfCZy.js";const H=["data-card-id","onContextmenu","onClick"],J=["href","title","onClick"],Q=["src","onError"],W={class:"link-text"},Z={key:0,class:"card-selected-badge"},nn={__name:"CardGrid",props:{cards:Array,selectedCards:Array,categoryId:Number,subCategoryId:[Number,null]},emits:["contextEdit","contextDelete","toggleCardSelection","openMovePanel","requireAuth"],setup(g,{emit:E}){const M=g,a=E,S=c(null),d=c(!1),v=c(0),x=c(0),l=c(null);function _(n,e){l.value=e,v.value=n.clientX,x.value=n.clientY,d.value=!0}function s(){d.value=!1,l.value=null}function D(){l.value&&a("contextEdit",l.value),s()}function I(){l.value&&a("contextDelete",l.value),s()}function L(){l.value&&a("toggleCardSelection",l.value),s()}function z(){l.value&&(m(l.value)||a("toggleCardSelection",l.value),a("openMovePanel")),s()}function O(){l.value&&(k(l.value.id),window.open(l.value.url,"_blank")),s()}function $(){l.value&&navigator.clipboard.writeText(l.value.url),s()}function C(n){d.value&&s()}function P(n,e){(n.ctrlKey||n.metaKey)&&(n.preventDefault(),n.stopPropagation(),a("toggleCardSelection",e))}function U(n,e){n.ctrlKey||n.metaKey?(n.preventDefault(),n.stopPropagation()):k(e.id)}function k(n){fetch(`/api/cards/${n}/click`,{method:"POST"}).catch(()=>{})}K(()=>{document.addEventListener("click",C),document.addEventListener("scroll",s)}),V(()=>{document.removeEventListener("click",C),document.removeEventListener("scroll",s)});function y(n){try{return new URL(n).origin}catch(e){return null}}function N(n){if(n.logo_url)return n.logo_url;const e=y(n.url);return e?`https://api.xinac.net/icon/?url=${e}&sz=128`:"/default-favicon.png"}const f=[n=>`https://api.xinac.net/icon/?url=${n}&sz=128`,n=>`https://api.afmax.cn/so/ico/index.php?r=${n}&sz=128`,n=>`https://icon.horse/icon/${n}`,n=>`https://www.google.com/s2/favicons?domain=${n}&sz=128`,n=>`https://favicon.im/${n}?larger=true`];function R(n,e){const o=n.target.src,p=y(e.url);if(!p){n.target.src="/default-favicon.png";return}n.target._cdnIndex===void 0&&(n.target._cdnIndex=0);for(let i=0;i<f.length;i++)if(f[i](p),o.includes("api.xinac.net")&&i===0||o.includes("api.afmax.cn")&&i===1||o.includes("icon.horse")&&i===2||o.includes("www.google.com/s2/favicons")&&i===3||o.includes("favicon.im")&&i===4){if(i+1<f.length){n.target._cdnIndex=i+1,n.target.src=f[i+1](p);return}break}n.target.src="/default-favicon.png"}function T(n){let e="";return n.desc&&(e+=n.desc+`
`),n.tags&&n.tags.length>0&&(e+="æ ‡ç­¾: "+n.tags.map(o=>o.name).join(", ")+`
`),e+=n.url,e}function B(n){return n?n.length>20?n.slice(0,20)+"...":n:""}function m(n){var e;return((e=M.selectedCards)==null?void 0:e.some(o=>o.id===n.id))||!1}return(n,e)=>(r(),u("div",{ref_key:"cardGridRef",ref:S,class:"container card-grid"},[(r(!0),u(A,null,F(g.cards,(o,p)=>(r(),u("div",{key:o.id,class:X(["link-item",{selected:m(o)}]),"data-card-id":o.id,onContextmenu:b(i=>_(i,o),["prevent"]),onClick:i=>P(i,o)},[t("a",{href:o.url,target:"_blank",title:T(o),onClick:i=>U(i,o),class:"card-link"},[t("img",{class:"link-icon",src:N(o),alt:"",onError:i=>R(i,o),loading:"lazy"},null,40,Q),t("span",W,w(B(o.title)),1)],8,J),m(o)?(r(),u("div",Z,"âœ“")):h("",!0)],42,H))),128)),(r(),j(q,{to:"body"},[d.value?(r(),u("div",{key:0,class:"context-menu",style:Y({left:v.value+"px",top:x.value+"px"}),onClick:e[0]||(e[0]=b(()=>{},["stop"]))},[t("div",{class:"context-menu-item",onClick:D},[...e[1]||(e[1]=[t("span",{class:"context-menu-icon"},"âœï¸",-1),t("span",null,"ç¼–è¾‘",-1)])]),t("div",{class:"context-menu-item",onClick:I},[...e[2]||(e[2]=[t("span",{class:"context-menu-icon"},"ğŸ—‘ï¸",-1),t("span",null,"åˆ é™¤",-1)])]),e[7]||(e[7]=t("div",{class:"context-menu-divider"},null,-1)),t("div",{class:"context-menu-item",onClick:L},[e[3]||(e[3]=t("span",{class:"context-menu-icon"},"â˜‘ï¸",-1)),t("span",null,w(m(l.value)?"å–æ¶ˆé€‰ä¸­":"é€‰ä¸­"),1)]),t("div",{class:"context-menu-item",onClick:z},[...e[4]||(e[4]=[t("span",{class:"context-menu-icon"},"ğŸ“",-1),t("span",null,"ç§»åŠ¨åˆ°...",-1)])]),e[8]||(e[8]=t("div",{class:"context-menu-divider"},null,-1)),t("div",{class:"context-menu-item",onClick:O},[...e[5]||(e[5]=[t("span",{class:"context-menu-icon"},"ğŸ”—",-1),t("span",null,"åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€",-1)])]),t("div",{class:"context-menu-item",onClick:$},[...e[6]||(e[6]=[t("span",{class:"context-menu-icon"},"ğŸ“‹",-1),t("span",null,"å¤åˆ¶é“¾æ¥",-1)])])],4)):h("",!0)]))],512))}},tn=G(nn,[["__scopeId","data-v-b9d88e98"]]);export{tn as default};
