var H=Object.defineProperty,K=Object.defineProperties;var Q=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var B=(v,o,l)=>o in v?H(v,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):v[o]=l,S=(v,o)=>{for(var l in o||(o={}))W.call(o,l)&&B(v,l,o[l]);if($)for(var l of $(o))X.call(o,l)&&B(v,l,o[l]);return v},A=(v,o)=>K(v,Q(o));var b=(v,o,l)=>new Promise((c,h)=>{var y=m=>{try{f(l.next(m))}catch(k){h(k)}},C=m=>{try{f(l.throw(m))}catch(k){h(k)}},f=m=>m.done?c(m.value):Promise.resolve(m.value).then(y,C);f((l=l.apply(v,o)).next())});import{_ as Y,r as _,e as V,g as Z,c as u,b as s,i as E,k as N,q as tt,d as U,t as p,F as x,a as z,o as d,p as L,n as et,w as st,C as at}from"./index-MGUDvhnE.js";import{g as ot,N as nt,h as lt}from"./api-DfQIEmB0.js";const it={class:"bookmark-manager"},ct={class:"header"},rt={class:"header-left"},ut={key:0,class:"import-panel"},dt={class:"import-header"},vt={class:"import-actions"},mt=["disabled"],pt={key:0,class:"check-summary"},ft={class:"batch-toolbar"},ht={class:"selected-count"},_t={class:"bookmark-list"},gt=["checked","onChange"],kt={class:"status-icon"},bt={key:0},yt={key:1},Ct={key:2},wt={key:3},It={key:4},Mt={class:"bookmark-info"},$t={class:"bookmark-title"},Bt={class:"bookmark-url"},St={key:0,class:"bookmark-folder"},At={class:"bookmark-category"},Vt=["onUpdate:modelValue"],Et=["value"],Nt={class:"import-footer"},Ut=["disabled"],xt={key:1,class:"empty-state"},zt={__name:"BookmarkManager",setup(v){const o=_([]),l=_([]),c=_([]),h=_(!1),y=_(0),C=_(!1),f=_(""),m=_(!1),k={"github.com":"å¼€å‘å·¥å…·","gitlab.com":"å¼€å‘å·¥å…·","stackoverflow.com":"å¼€å‘å·¥å…·","youtube.com":"è§†é¢‘","bilibili.com":"è§†é¢‘","twitter.com":"ç¤¾äº¤","facebook.com":"ç¤¾äº¤","weibo.com":"ç¤¾äº¤","zhihu.com":"ç¤¾åŒº","reddit.com":"ç¤¾åŒº","amazon.com":"è´­ç‰©","taobao.com":"è´­ç‰©","jd.com":"è´­ç‰©"},w=V(()=>{const a={valid:0,invalid:0,timeout:0,duplicate:0,pending:0};return o.value.forEach(t=>{a[t.status||"pending"]++}),a}),O=V(()=>f.value?o.value.filter(a=>a.status===f.value):o.value);function R(a){try{const t=new URL(a).hostname.replace("www.","");for(const[i,e]of Object.entries(k))if(t.includes(i)){const r=l.value.find(n=>n.name.includes(e));return(r==null?void 0:r.id)||""}}catch(t){}return""}function j(){return b(this,null,function*(){try{const a=yield ot();l.value=a.data}catch(a){console.error("åŠ è½½èœå•å¤±è´¥:",a)}})}function D(){return b(this,null,function*(){var t,i;if(h.value)return;h.value=!0,y.value=0;const a=o.value.map(e=>({url:e.url,title:e.title,folder:e.folder}));try{const e=yield nt(a),r={};[...e.data.valid,...e.data.invalid,...e.data.timeout,...e.data.duplicate].forEach(n=>{r[n.url]=n.status}),o.value.forEach(n=>{n.status=r[n.url]||"valid"}),C.value=!0}catch(e){console.error("æ£€æµ‹å¤±è´¥:",e),alert("æ£€æµ‹å¤±è´¥: "+(((i=(t=e.response)==null?void 0:t.data)==null?void 0:i.error)||e.message))}finally{h.value=!1}})}function F(a){const t=c.value.indexOf(a);t>-1?c.value.splice(t,1):c.value.push(a)}function q(){c.value=o.value.map((a,t)=>t)}function J(){c.value=o.value.map((a,t)=>a.status==="valid"||!a.status?t:-1).filter(a=>a>=0)}function P(){c.value=[]}function T(){return b(this,null,function*(){var a,t;if(c.value.length!==0){m.value=!0;try{const i={};c.value.forEach(r=>{var M;const n=o.value[r],g=n.targetMenuId||((M=l.value[0])==null?void 0:M.id);g&&(i[g]||(i[g]=[]),i[g].push({title:n.title,url:n.url,logo:`https://api.xinac.net/icon/?url=${new URL(n.url).origin}&sz=128`,description:""}))});let e=0;for(const[r,n]of Object.entries(i)){const g=yield lt(parseInt(r),null,n);e+=g.data.added||0}alert(`æˆåŠŸå¯¼å…¥ ${e} ä¸ªä¹¦ç­¾`),window.location.href="/"}catch(i){console.error("å¯¼å…¥å¤±è´¥:",i),alert("å¯¼å…¥å¤±è´¥: "+(((t=(a=i.response)==null?void 0:a.data)==null?void 0:t.error)||i.message))}finally{m.value=!1}}})}function G(){window.location.href="/"}function I(){const a=sessionStorage.getItem("pendingBookmarks");if(a)try{const t=JSON.parse(a);Array.isArray(t)&&t.length>0&&(o.value=t.map(i=>A(S({},i),{status:"",targetMenuId:R(i.url)})),sessionStorage.removeItem("pendingBookmarks"))}catch(t){console.error("è§£æžä¹¦ç­¾æ•°æ®å¤±è´¥:",t)}}return Z(()=>b(null,null,function*(){yield j(),I(),window.addEventListener("bookmarksReady",()=>{I()})})),(a,t)=>{const i=tt("router-link");return d(),u("div",it,[s("div",ct,[s("div",rt,[E(i,{to:"/",class:"back-btn"},{default:N(()=>t[5]||(t[5]=[L("â† è¿”å›žé¦–é¡µ")])),_:1,__:[5]}),t[6]||(t[6]=s("h1",null,"ðŸ“š ä¹¦ç­¾å¯¼å…¥",-1))])]),o.value.length>0?(d(),u("div",ut,[s("div",dt,[s("h2",null,"å¾…å¯¼å…¥ä¹¦ç­¾ ("+p(o.value.length)+")",1),s("div",vt,[s("button",{onClick:D,class:"btn btn-check",disabled:h.value},p(h.value?`æ£€æµ‹ä¸­ ${y.value}/${o.value.length}`:"ðŸ” æ£€æµ‹é“¾æŽ¥æœ‰æ•ˆæ€§"),9,mt)])]),C.value?(d(),u("div",pt,[s("span",{class:"status-tag valid",onClick:t[0]||(t[0]=e=>f.value="valid")},"âœ… æœ‰æ•ˆ "+p(w.value.valid),1),s("span",{class:"status-tag timeout",onClick:t[1]||(t[1]=e=>f.value="timeout")},"âš ï¸ è¶…æ—¶ "+p(w.value.timeout),1),s("span",{class:"status-tag invalid",onClick:t[2]||(t[2]=e=>f.value="invalid")},"âŒ å¤±æ•ˆ "+p(w.value.invalid),1),s("span",{class:"status-tag duplicate",onClick:t[3]||(t[3]=e=>f.value="duplicate")},"ðŸ”„ é‡å¤ "+p(w.value.duplicate),1),s("span",{class:"status-tag",onClick:t[4]||(t[4]=e=>f.value="")},"å…¨éƒ¨")])):U("",!0),s("div",ft,[s("button",{onClick:J,class:"btn btn-sm"},"å…¨é€‰æœ‰æ•ˆ"),s("button",{onClick:q,class:"btn btn-sm"},"å…¨é€‰"),s("button",{onClick:P,class:"btn btn-sm"},"æ¸…é™¤é€‰æ‹©"),s("span",ht,"å·²é€‰ "+p(c.value.length)+" é¡¹",1)]),s("div",_t,[(d(!0),u(x,null,z(O.value,(e,r)=>(d(),u("div",{key:r,class:et(["bookmark-item",[e.status,{selected:c.value.includes(r)}]])},[s("input",{type:"checkbox",checked:c.value.includes(r),onChange:n=>F(r)},null,40,gt),s("div",kt,[e.status==="valid"?(d(),u("span",bt,"âœ…")):e.status==="invalid"?(d(),u("span",yt,"âŒ")):e.status==="timeout"?(d(),u("span",Ct,"âš ï¸")):e.status==="duplicate"?(d(),u("span",wt,"ðŸ”„")):(d(),u("span",It,"â³"))]),s("div",Mt,[s("div",$t,p(e.title),1),s("div",Bt,p(e.url),1),e.folder?(d(),u("div",St,"ðŸ“ "+p(e.folder),1)):U("",!0)]),s("div",At,[st(s("select",{"onUpdate:modelValue":n=>e.targetMenuId=n,class:"category-select"},[t[7]||(t[7]=s("option",{value:""},"é€‰æ‹©åˆ†ç±»",-1)),(d(!0),u(x,null,z(l.value,n=>(d(),u("option",{key:n.id,value:n.id},p(n.name),9,Et))),128))],8,Vt),[[at,e.targetMenuId]])])],2))),128))]),s("div",Nt,[s("button",{onClick:G,class:"btn btn-secondary"},"å–æ¶ˆ"),s("button",{onClick:T,class:"btn btn-primary",disabled:c.value.length===0||m.value},p(m.value?"å¯¼å…¥ä¸­...":`å¯¼å…¥é€‰ä¸­ (${c.value.length})`),9,Ut)])])):(d(),u("div",xt,[t[9]||(t[9]=s("p",null,"ðŸ“­ æš‚æ— å¾…å¯¼å…¥çš„ä¹¦ç­¾",-1)),t[10]||(t[10]=s("p",{class:"hint"},"è¯·ä½¿ç”¨æµè§ˆå™¨æ‰©å±•é€‰æ‹©ä¹¦ç­¾åŽå¯¼å…¥",-1)),E(i,{to:"/",class:"btn btn-primary"},{default:N(()=>t[8]||(t[8]=[L("è¿”å›žé¦–é¡µ")])),_:1,__:[8]})]))])}}},jt=Y(zt,[["__scopeId","data-v-7e9b2c64"]]);export{jt as default};
