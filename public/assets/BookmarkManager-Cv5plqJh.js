var J=Object.defineProperty,G=Object.defineProperties;var H=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var A=(v,a,i)=>a in v?J(v,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):v[a]=i,I=(v,a)=>{for(var i in a||(a={}))Q.call(a,i)&&A(v,i,a[i]);if(S)for(var i of S(a))W.call(a,i)&&A(v,i,a[i]);return v},M=(v,a)=>G(v,H(a));var y=(v,a,i)=>new Promise((c,h)=>{var b=m=>{try{f(i.next(m))}catch(k){h(k)}},C=m=>{try{f(i.throw(m))}catch(k){h(k)}},f=m=>m.done?c(m.value):Promise.resolve(m.value).then(b,C);f((i=i.apply(v,a)).next())});import{_ as X,r as _,e as O,g as Y,c as u,b as s,i as V,k as N,q as Z,d as U,t as p,F as x,a as E,o as d,p as R,n as tt,w as et,C as st}from"./index-ULEV1u-D.js";import{g as at,N as ot,h as nt}from"./api-DfQIEmB0.js";const lt={class:"bookmark-manager"},it={class:"header"},ct={class:"header-left"},rt={key:0,class:"import-panel"},ut={class:"import-header"},dt={class:"import-actions"},vt=["disabled"],mt={key:0,class:"check-summary"},pt={class:"batch-toolbar"},ft={class:"selected-count"},ht={class:"bookmark-list"},_t=["checked","onChange"],gt={class:"status-icon"},kt={key:0},yt={key:1},bt={key:2},Ct={key:3},wt={key:4},It={class:"bookmark-info"},Mt={class:"bookmark-title"},$t={class:"bookmark-url"},Bt={key:0,class:"bookmark-folder"},St={class:"bookmark-category"},At=["onUpdate:modelValue"],Ot=["value"],Vt={class:"import-footer"},Nt=["disabled"],Ut={key:1,class:"empty-state"},xt={__name:"BookmarkManager",setup(v){const a=_([]),i=_([]),c=_([]),h=_(!1),b=_(0),C=_(!1),f=_(""),m=_(!1),k={"github.com":"å¼€å‘å·¥å…·","gitlab.com":"å¼€å‘å·¥å…·","stackoverflow.com":"å¼€å‘å·¥å…·","youtube.com":"è§†é¢‘","bilibili.com":"è§†é¢‘","twitter.com":"ç¤¾äº¤","facebook.com":"ç¤¾äº¤","weibo.com":"ç¤¾äº¤","zhihu.com":"ç¤¾åŒº","reddit.com":"ç¤¾åŒº","amazon.com":"è´­ç‰©","taobao.com":"è´­ç‰©","jd.com":"è´­ç‰©"},w=O(()=>{const o={valid:0,invalid:0,timeout:0,duplicate:0,pending:0};return a.value.forEach(t=>{o[t.status||"pending"]++}),o}),z=O(()=>f.value?a.value.filter(o=>o.status===f.value):a.value);function $(o){try{const t=new URL(o).hostname.replace("www.","");for(const[n,e]of Object.entries(k))if(t.includes(n)){const r=i.value.find(l=>l.name.includes(e));return(r==null?void 0:r.id)||""}}catch(t){}return""}function L(){return y(this,null,function*(){try{const o=yield at();i.value=o.data}catch(o){console.error("åŠ è½½èœå•å¤±è´¥:",o)}})}function j(){return y(this,null,function*(){var t,n;if(h.value)return;h.value=!0,b.value=0;const o=a.value.map(e=>({url:e.url,title:e.title,folder:e.folder}));try{const e=yield ot(o),r={};[...e.data.valid,...e.data.invalid,...e.data.timeout,...e.data.duplicate].forEach(l=>{r[l.url]=l.status}),a.value.forEach(l=>{l.status=r[l.url]||"valid"}),C.value=!0}catch(e){console.error("æ£€æµ‹å¤±è´¥:",e),alert("æ£€æµ‹å¤±è´¥: "+(((n=(t=e.response)==null?void 0:t.data)==null?void 0:n.error)||e.message))}finally{h.value=!1}})}function D(o){const t=c.value.indexOf(o);t>-1?c.value.splice(t,1):c.value.push(o)}function F(){c.value=a.value.map((o,t)=>t)}function K(){c.value=a.value.map((o,t)=>o.status==="valid"||!o.status?t:-1).filter(o=>o>=0)}function P(){c.value=[]}function T(){return y(this,null,function*(){var o,t;if(c.value.length!==0){m.value=!0;try{const n={};c.value.forEach(r=>{var B;const l=a.value[r],g=l.targetMenuId||((B=i.value[0])==null?void 0:B.id);g&&(n[g]||(n[g]=[]),n[g].push({title:l.title,url:l.url,logo:`https://api.xinac.net/icon/?url=${new URL(l.url).origin}&sz=128`,description:""}))});let e=0;for(const[r,l]of Object.entries(n)){const g=yield nt(parseInt(r),null,l);e+=g.data.added||0}alert(`æˆåŠŸå¯¼å…¥ ${e} ä¸ªä¹¦ç­¾`),window.location.href="/"}catch(n){console.error("å¯¼å…¥å¤±è´¥:",n),alert("å¯¼å…¥å¤±è´¥: "+(((t=(o=n.response)==null?void 0:o.data)==null?void 0:t.error)||n.message))}finally{m.value=!1}}})}function q(){window.location.href="/"}return Y(()=>y(null,null,function*(){yield L();const o=sessionStorage.getItem("pendingBookmarks");if(o)try{const t=JSON.parse(o);Array.isArray(t)&&t.length>0&&(a.value=t.map(n=>M(I({},n),{status:"",targetMenuId:$(n.url)})),sessionStorage.removeItem("pendingBookmarks"))}catch(t){console.error("è§£æžä¹¦ç­¾æ•°æ®å¤±è´¥:",t)}typeof chrome!="undefined"&&chrome.runtime&&chrome.runtime.onMessage.addListener(t=>{t.type==="IMPORT_BOOKMARKS"&&t.bookmarks&&(a.value=t.bookmarks.map(n=>M(I({},n),{status:"",targetMenuId:$(n.url)})))})})),(o,t)=>{const n=Z("router-link");return d(),u("div",lt,[s("div",it,[s("div",ct,[V(n,{to:"/",class:"back-btn"},{default:N(()=>t[5]||(t[5]=[R("â† è¿”å›žé¦–é¡µ")])),_:1,__:[5]}),t[6]||(t[6]=s("h1",null,"ðŸ“š ä¹¦ç­¾å¯¼å…¥",-1))])]),a.value.length>0?(d(),u("div",rt,[s("div",ut,[s("h2",null,"å¾…å¯¼å…¥ä¹¦ç­¾ ("+p(a.value.length)+")",1),s("div",dt,[s("button",{onClick:j,class:"btn btn-check",disabled:h.value},p(h.value?`æ£€æµ‹ä¸­ ${b.value}/${a.value.length}`:"ðŸ” æ£€æµ‹é“¾æŽ¥æœ‰æ•ˆæ€§"),9,vt)])]),C.value?(d(),u("div",mt,[s("span",{class:"status-tag valid",onClick:t[0]||(t[0]=e=>f.value="valid")},"âœ… æœ‰æ•ˆ "+p(w.value.valid),1),s("span",{class:"status-tag timeout",onClick:t[1]||(t[1]=e=>f.value="timeout")},"âš ï¸ è¶…æ—¶ "+p(w.value.timeout),1),s("span",{class:"status-tag invalid",onClick:t[2]||(t[2]=e=>f.value="invalid")},"âŒ å¤±æ•ˆ "+p(w.value.invalid),1),s("span",{class:"status-tag duplicate",onClick:t[3]||(t[3]=e=>f.value="duplicate")},"ðŸ”„ é‡å¤ "+p(w.value.duplicate),1),s("span",{class:"status-tag",onClick:t[4]||(t[4]=e=>f.value="")},"å…¨éƒ¨")])):U("",!0),s("div",pt,[s("button",{onClick:K,class:"btn btn-sm"},"å…¨é€‰æœ‰æ•ˆ"),s("button",{onClick:F,class:"btn btn-sm"},"å…¨é€‰"),s("button",{onClick:P,class:"btn btn-sm"},"æ¸…é™¤é€‰æ‹©"),s("span",ft,"å·²é€‰ "+p(c.value.length)+" é¡¹",1)]),s("div",ht,[(d(!0),u(x,null,E(z.value,(e,r)=>(d(),u("div",{key:r,class:tt(["bookmark-item",[e.status,{selected:c.value.includes(r)}]])},[s("input",{type:"checkbox",checked:c.value.includes(r),onChange:l=>D(r)},null,40,_t),s("div",gt,[e.status==="valid"?(d(),u("span",kt,"âœ…")):e.status==="invalid"?(d(),u("span",yt,"âŒ")):e.status==="timeout"?(d(),u("span",bt,"âš ï¸")):e.status==="duplicate"?(d(),u("span",Ct,"ðŸ”„")):(d(),u("span",wt,"â³"))]),s("div",It,[s("div",Mt,p(e.title),1),s("div",$t,p(e.url),1),e.folder?(d(),u("div",Bt,"ðŸ“ "+p(e.folder),1)):U("",!0)]),s("div",St,[et(s("select",{"onUpdate:modelValue":l=>e.targetMenuId=l,class:"category-select"},[t[7]||(t[7]=s("option",{value:""},"é€‰æ‹©åˆ†ç±»",-1)),(d(!0),u(x,null,E(i.value,l=>(d(),u("option",{key:l.id,value:l.id},p(l.name),9,Ot))),128))],8,At),[[st,e.targetMenuId]])])],2))),128))]),s("div",Vt,[s("button",{onClick:q,class:"btn btn-secondary"},"å–æ¶ˆ"),s("button",{onClick:T,class:"btn btn-primary",disabled:c.value.length===0||m.value},p(m.value?"å¯¼å…¥ä¸­...":`å¯¼å…¥é€‰ä¸­ (${c.value.length})`),9,Nt)])])):(d(),u("div",Ut,[t[9]||(t[9]=s("p",null,"ðŸ“­ æš‚æ— å¾…å¯¼å…¥çš„ä¹¦ç­¾",-1)),t[10]||(t[10]=s("p",{class:"hint"},"è¯·ä½¿ç”¨æµè§ˆå™¨æ‰©å±•é€‰æ‹©ä¹¦ç­¾åŽå¯¼å…¥",-1)),V(n,{to:"/",class:"btn btn-primary"},{default:N(()=>t[8]||(t[8]=[R("è¿”å›žé¦–é¡µ")])),_:1,__:[8]})]))])}}},Lt=X(xt,[["__scopeId","data-v-978f0f65"]]);export{Lt as default};
