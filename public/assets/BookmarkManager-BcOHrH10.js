var G=Object.defineProperty,H=Object.defineProperties;var K=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var $=(v,a,n)=>a in v?G(v,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):v[a]=n,S=(v,a)=>{for(var n in a||(a={}))Q.call(a,n)&&$(v,n,a[n]);if(M)for(var n of M(a))W.call(a,n)&&$(v,n,a[n]);return v},U=(v,a)=>H(v,K(a));var b=(v,a,n)=>new Promise((r,f)=>{var y=p=>{try{h(n.next(p))}catch(k){f(k)}},C=p=>{try{h(n.throw(p))}catch(k){f(k)}},h=p=>p.done?r(p.value):Promise.resolve(p.value).then(y,C);h((n=n.apply(v,a)).next())});import{_ as X,r as _,e as A,g as Y,c as u,b as s,i as B,k as V,q as Z,d as N,t as m,F as x,a as E,o as d,p as R,n as tt,w as et,C as st}from"./index-y5rOSdJp.js";import{g as at,N as ot,h as lt}from"./api-DfQIEmB0.js";const nt={class:"bookmark-manager"},it={class:"header"},ct={class:"header-left"},rt={key:0,class:"import-panel"},ut={class:"import-header"},dt={class:"import-actions"},vt=["disabled"],pt={key:0,class:"check-summary"},mt={class:"batch-toolbar"},ht={class:"selected-count"},ft={class:"bookmark-list"},_t=["checked","onChange"],gt={class:"status-icon"},kt={key:0},bt={key:1},yt={key:2},Ct={key:3},wt={key:4},It={class:"bookmark-info"},Mt={class:"bookmark-title"},$t={class:"bookmark-url"},St={key:0,class:"bookmark-folder"},Ut={class:"bookmark-category"},At=["onUpdate:modelValue"],Bt=["value"],Vt={class:"import-footer"},Nt=["disabled"],xt={key:1,class:"empty-state"},Et={__name:"BookmarkManager",setup(v){const a=_([]),n=_([]),r=_([]),f=_(!1),y=_(0),C=_(!1),h=_(""),p=_(!1),k={"github.com":"å¼€å‘å·¥å…·","gitlab.com":"å¼€å‘å·¥å…·","stackoverflow.com":"å¼€å‘å·¥å…·","youtube.com":"è§†é¢‘","bilibili.com":"è§†é¢‘","twitter.com":"ç¤¾äº¤","facebook.com":"ç¤¾äº¤","weibo.com":"ç¤¾äº¤","zhihu.com":"ç¤¾åŒº","reddit.com":"ç¤¾åŒº","amazon.com":"è´­ç‰©","taobao.com":"è´­ç‰©","jd.com":"è´­ç‰©"},w=A(()=>{const o={valid:0,invalid:0,timeout:0,duplicate:0,pending:0};return a.value.forEach(t=>{o[t.status||"pending"]++}),o}),z=A(()=>h.value?a.value.filter(o=>o.status===h.value):a.value);function L(o){try{const t=new URL(o).hostname.replace("www.","");for(const[i,e]of Object.entries(k))if(t.includes(i)){const c=n.value.find(l=>l.name.includes(e));return(c==null?void 0:c.id)||""}}catch(t){}return""}function O(){return b(this,null,function*(){try{const o=yield at();n.value=o.data}catch(o){console.error("åŠ è½½èœå•å¤±è´¥:",o)}})}function P(){return b(this,null,function*(){var t,i;if(f.value)return;f.value=!0,y.value=0;const o=a.value.map(e=>({url:e.url,title:e.title,folder:e.folder}));try{const e=yield ot(o),c={};[...e.data.valid,...e.data.invalid,...e.data.timeout,...e.data.duplicate].forEach(l=>{c[l.url]=l.status}),a.value.forEach(l=>{l.status=c[l.url]||"valid"}),C.value=!0}catch(e){console.error("æ£€æµ‹å¤±è´¥:",e),alert("æ£€æµ‹å¤±è´¥: "+(((i=(t=e.response)==null?void 0:t.data)==null?void 0:i.error)||e.message))}finally{f.value=!1}})}function j(o){const t=r.value.indexOf(o);t>-1?r.value.splice(t,1):r.value.push(o)}function D(){r.value=a.value.map((o,t)=>t)}function F(){r.value=a.value.map((o,t)=>o.status==="valid"||!o.status?t:-1).filter(o=>o>=0)}function q(){r.value=[]}function J(){return b(this,null,function*(){var o,t;if(r.value.length!==0){p.value=!0;try{const i={};r.value.forEach(c=>{var I;const l=a.value[c],g=l.targetMenuId||((I=n.value[0])==null?void 0:I.id);g&&(i[g]||(i[g]=[]),i[g].push({title:l.title,url:l.url,logo:`https://api.xinac.net/icon/?url=${new URL(l.url).origin}&sz=128`,description:""}))});let e=0;for(const[c,l]of Object.entries(i)){const g=yield lt(parseInt(c),null,l);e+=g.data.added||0}alert(`æˆåŠŸå¯¼å…¥ ${e} ä¸ªä¹¦ç­¾`),window.location.href="/"}catch(i){console.error("å¯¼å…¥å¤±è´¥:",i),alert("å¯¼å…¥å¤±è´¥: "+(((t=(o=i.response)==null?void 0:o.data)==null?void 0:t.error)||i.message))}finally{p.value=!1}}})}function T(){window.location.href="/"}return Y(()=>b(null,null,function*(){yield O();const t=new URLSearchParams(window.location.search).get("data");if(t)try{const i=decodeURIComponent(escape(atob(t))),e=JSON.parse(i);Array.isArray(e)&&e.length>0&&(a.value=e.map(c=>U(S({},c),{status:"",targetMenuId:L(c.url)})))}catch(i){console.error("è§£æžä¹¦ç­¾æ•°æ®å¤±è´¥:",i)}})),(o,t)=>{const i=Z("router-link");return d(),u("div",nt,[s("div",it,[s("div",ct,[B(i,{to:"/",class:"back-btn"},{default:V(()=>t[5]||(t[5]=[R("â† è¿”å›žé¦–é¡µ")])),_:1,__:[5]}),t[6]||(t[6]=s("h1",null,"ðŸ“š ä¹¦ç­¾å¯¼å…¥",-1))])]),a.value.length>0?(d(),u("div",rt,[s("div",ut,[s("h2",null,"å¾…å¯¼å…¥ä¹¦ç­¾ ("+m(a.value.length)+")",1),s("div",dt,[s("button",{onClick:P,class:"btn btn-check",disabled:f.value},m(f.value?`æ£€æµ‹ä¸­ ${y.value}/${a.value.length}`:"ðŸ” æ£€æµ‹é“¾æŽ¥æœ‰æ•ˆæ€§"),9,vt)])]),C.value?(d(),u("div",pt,[s("span",{class:"status-tag valid",onClick:t[0]||(t[0]=e=>h.value="valid")},"âœ… æœ‰æ•ˆ "+m(w.value.valid),1),s("span",{class:"status-tag timeout",onClick:t[1]||(t[1]=e=>h.value="timeout")},"âš ï¸ è¶…æ—¶ "+m(w.value.timeout),1),s("span",{class:"status-tag invalid",onClick:t[2]||(t[2]=e=>h.value="invalid")},"âŒ å¤±æ•ˆ "+m(w.value.invalid),1),s("span",{class:"status-tag duplicate",onClick:t[3]||(t[3]=e=>h.value="duplicate")},"ðŸ”„ é‡å¤ "+m(w.value.duplicate),1),s("span",{class:"status-tag",onClick:t[4]||(t[4]=e=>h.value="")},"å…¨éƒ¨")])):N("",!0),s("div",mt,[s("button",{onClick:F,class:"btn btn-sm"},"å…¨é€‰æœ‰æ•ˆ"),s("button",{onClick:D,class:"btn btn-sm"},"å…¨é€‰"),s("button",{onClick:q,class:"btn btn-sm"},"æ¸…é™¤é€‰æ‹©"),s("span",ht,"å·²é€‰ "+m(r.value.length)+" é¡¹",1)]),s("div",ft,[(d(!0),u(x,null,E(z.value,(e,c)=>(d(),u("div",{key:c,class:tt(["bookmark-item",[e.status,{selected:r.value.includes(c)}]])},[s("input",{type:"checkbox",checked:r.value.includes(c),onChange:l=>j(c)},null,40,_t),s("div",gt,[e.status==="valid"?(d(),u("span",kt,"âœ…")):e.status==="invalid"?(d(),u("span",bt,"âŒ")):e.status==="timeout"?(d(),u("span",yt,"âš ï¸")):e.status==="duplicate"?(d(),u("span",Ct,"ðŸ”„")):(d(),u("span",wt,"â³"))]),s("div",It,[s("div",Mt,m(e.title),1),s("div",$t,m(e.url),1),e.folder?(d(),u("div",St,"ðŸ“ "+m(e.folder),1)):N("",!0)]),s("div",Ut,[et(s("select",{"onUpdate:modelValue":l=>e.targetMenuId=l,class:"category-select"},[t[7]||(t[7]=s("option",{value:""},"é€‰æ‹©åˆ†ç±»",-1)),(d(!0),u(x,null,E(n.value,l=>(d(),u("option",{key:l.id,value:l.id},m(l.name),9,Bt))),128))],8,At),[[st,e.targetMenuId]])])],2))),128))]),s("div",Vt,[s("button",{onClick:T,class:"btn btn-secondary"},"å–æ¶ˆ"),s("button",{onClick:J,class:"btn btn-primary",disabled:r.value.length===0||p.value},m(p.value?"å¯¼å…¥ä¸­...":`å¯¼å…¥é€‰ä¸­ (${r.value.length})`),9,Nt)])])):(d(),u("div",xt,[t[9]||(t[9]=s("p",null,"ðŸ“­ æš‚æ— å¾…å¯¼å…¥çš„ä¹¦ç­¾",-1)),t[10]||(t[10]=s("p",{class:"hint"},"è¯·ä½¿ç”¨æµè§ˆå™¨æ‰©å±•é€‰æ‹©ä¹¦ç­¾åŽå¯¼å…¥",-1)),B(i,{to:"/",class:"btn btn-primary"},{default:V(()=>t[8]||(t[8]=[R("è¿”å›žé¦–é¡µ")])),_:1,__:[8]})]))])}}},Ot=X(Et,[["__scopeId","data-v-5454ecde"]]);export{Ot as default};
